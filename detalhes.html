<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes das Despesas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style> 
        body { font-family: 'Inter', sans-serif; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .tab.active { border-color: #06b6d4; color: #06b6d4; }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <div id="loader" class="fixed inset-0 bg-gray-900 bg-opacity-80 flex items-center justify-center z-50"><p>A carregar...</p></div>

    <div id="app-content" class="container mx-auto p-4 md:p-8 max-w-5xl hidden">
        <header class="flex flex-wrap justify-between items-center mb-8 gap-4">
            <div><h1 class="text-3xl font-bold text-cyan-400">Gerir Finanças</h1></div>
            <div class="flex items-center gap-4">
                <a href="index.html" class="bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg">&larr; Voltar ao Painel</a>
                <button id="logout-btn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg">Sair</button>
            </div>
        </header>

        <!-- Abas de Navegação -->
        <div class="mb-6 border-b border-gray-700">
            <nav class="flex space-x-8" aria-label="Tabs">
                <button class="tab active py-4 px-1 border-b-2 font-medium text-lg border-transparent text-gray-400 hover:text-gray-200 hover:border-gray-500" data-tab="despesas">Despesas do Mês</button>
                <button class="tab py-4 px-1 border-b-2 font-medium text-lg border-transparent text-gray-400 hover:text-gray-200 hover:border-gray-500" data-tab="cartoes">Cartões de Crédito</button>
                <button class="tab py-4 px-1 border-b-2 font-medium text-lg border-transparent text-gray-400 hover:text-gray-200 hover:border-gray-500" data-tab="emprestimos">Empréstimos</button>
            </nav>
        </div>

        <!-- Conteúdo das Abas -->
        <div id="despesas" class="tab-content active">
             <section class="bg-gray-800 p-6 rounded-xl shadow-lg mb-8">
                <h2 class="text-2xl font-bold mb-4">Adicionar Despesa</h2>
                <form id="form-despesa" class="grid grid-cols-1 md:grid-cols-5 gap-4 items-end mb-6">
                    <div class="md:col-span-2"><label for="descricao-despesa" class="block mb-2 text-sm text-gray-400">Descrição</label><input type="text" id="descricao-despesa" class="bg-gray-700 w-full p-2.5 rounded-lg" required></div>
                    <div><label for="valor-despesa" class="block mb-2 text-sm text-gray-400">Valor (R$)</label><input type="number" id="valor-despesa" step="0.01" class="bg-gray-700 w-full p-2.5 rounded-lg" required></div>
                    <div><label for="tipo-despesa" class="block mb-2 text-sm text-gray-400">Tipo</label><select id="tipo-despesa" class="bg-gray-700 w-full p-2.5 rounded-lg"><option value="variavel">Variável</option><option value="fixa">Fixa</option></select></div>
                    <button type="submit" class="bg-red-500 hover:bg-red-600 font-bold py-2.5 px-6 rounded-lg h-11">Adicionar</button>
                </form>
                <div id="lista-despesas" class="space-y-3"></div>
            </section>
        </div>

        <div id="cartoes" class="tab-content">
            <section class="bg-gray-800 p-6 rounded-xl shadow-lg mb-8">
                <h2 class="text-2xl font-bold mb-4">Adicionar Novo Cartão</h2>
                <form id="form-add-cartao" class="grid grid-cols-1 md:grid-cols-6 gap-4 items-end">
                    <div class="md:col-span-2"><label class="block text-sm mb-2">Nome</label><input type="text" id="nome-cartao" class="bg-gray-700 w-full p-2.5 rounded-lg" placeholder="Ex: Nubank UV" required></div>
                    <div><label class="block text-sm mb-2">Limite</label><input type="number" id="limite-cartao" class="bg-gray-700 w-full p-2.5 rounded-lg" placeholder="5000" required></div>
                    <div><label class="block text-sm mb-2">Dia Fecho</label><input type="number" id="fechamento-cartao" class="bg-gray-700 w-full p-2.5 rounded-lg" placeholder="20" required></div>
                    <div><label class="block text-sm mb-2">Dia Vencimento</label><input type="number" id="vencimento-cartao" class="bg-gray-700 w-full p-2.5 rounded-lg" placeholder="27" required></div>
                    <button type="submit" class="bg-cyan-500 hover:bg-cyan-600 font-bold py-2.5 px-6 rounded-lg h-11">Adicionar</button>
                </form>
            </section>
            <div id="container-cartoes" class="space-y-6"></div>
        </div>
        
        <div id="emprestimos" class="tab-content">
             <section class="bg-gray-800 p-6 rounded-xl shadow-lg mb-8">
                <h2 class="text-2xl font-bold mb-4">Adicionar Empréstimo ou Financiamento</h2>
                <form id="form-add-emprestimo" class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                    <div class="md:col-span-2"><label class="block text-sm mb-2">Descrição</label><input type="text" id="nome-emprestimo" class="bg-gray-700 w-full p-2.5 rounded-lg" placeholder="Financiamento Carro" required></div>
                    <div><label class="block text-sm mb-2">Valor Parcela</label><input type="number" id="valor-parcela-emprestimo" class="bg-gray-700 w-full p-2.5 rounded-lg" required></div>
                    <div><label class="block text-sm mb-2">Total de Parcelas</label><input type="number" id="total-parcelas-emprestimo" class="bg-gray-700 w-full p-2.5 rounded-lg" required></div>
                    <button type="submit" class="md:col-start-4 bg-cyan-500 hover:bg-cyan-600 font-bold py-2.5 px-6 rounded-lg h-11">Adicionar</button>
                </form>
            </section>
            <div id="container-emprestimos" class="space-y-6"></div>
        </div>

    </div>

    <!-- CONFIGURAÇÃO DO FIREBASE -->
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyAvUqbV2e0ewur3G7VQExREDuWbopb6pNU",
        authDomain: "financeiro-controle-35d72.firebaseapp.com",
        projectId: "financeiro-controle-35d72",
        storageBucket: "financeiro-controle-35d72.appspot.com",
        messagingSenderId: "587216584759",
        appId: "1:587216584759:web:036ed465f1b2b2439d3fb2",
        measurementId: "G-F1JCZNV7BX"
      };
    </script>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, addDoc, doc, query } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUserId = null;
        
        onAuthStateChanged(auth, user => {
            if (user) {
                currentUserId = user.uid;
                setupPage();
                document.getElementById('loader').style.display = 'none';
                document.getElementById('app-content').classList.remove('hidden');
            } else {
                window.location.href = 'login.html';
            }
        });

        function setupPage() {
            document.getElementById('logout-btn').addEventListener('click', () => signOut(auth));

            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    document.getElementById(tab.dataset.tab).classList.add('active');
                });
            });

            // Lógica dos formulários
            const formDespesa = document.getElementById('form-despesa');
            formDespesa.addEventListener('submit', e => {
                e.preventDefault();
                const ref = collection(db, "users", currentUserId, "despesas");
                addDoc(ref, {
                    descricao: formDespesa['descricao-despesa'].value,
                    valor: parseFloat(formDespesa['valor-despesa'].value),
                    tipo: formDespesa['tipo-despesa'].value,
                    data: new Date()
                });
                formDespesa.reset();
            });

            const formCartao = document.getElementById('form-add-cartao');
            formCartao.addEventListener('submit', e => {
                 e.preventDefault();
                const ref = collection(db, "users", currentUserId, "cartoes");
                 addDoc(ref, {
                    nome: formCartao['nome-cartao'].value,
                    limite: parseFloat(formCartao['limite-cartao'].value),
                    diaFechamento: parseInt(formCartao['fechamento-cartao'].value),
                    diaVencimento: parseInt(formCartao['vencimento-cartao'].value),
                });
                formCartao.reset();
            });
            
            // Listeners para os dados
            listenToDespesas();
            listenToCartoes();
        }

        function listenToDespesas() {
            const despesasRef = collection(db, "users", currentUserId, "despesas");
            onSnapshot(query(despesasRef), snapshot => {
                const despesas = snapshot.docs.map(d => ({id: d.id, ...d.data()}));
                const listaEl = document.getElementById('lista-despesas');
                listaEl.innerHTML = despesas.length ? '' : '<p class="text-gray-500">Nenhuma despesa este mês.</p>';
                // A lógica de renderização iria aqui
            });
        }
        
        function listenToCartoes() {
            const cartoesRef = collection(db, "users", currentUserId, "cartoes");
            onSnapshot(query(cartoesRef), snapshot => {
                const containerEl = document.getElementById('container-cartoes');
                containerEl.innerHTML = ''; // Limpar antes de renderizar
                snapshot.docs.forEach(cartaoDoc => {
                    const cartao = { id: cartaoDoc.id, ...cartaoDoc.data() };
                    const cartaoEl = document.createElement('div');
                    cartaoEl.className = 'bg-gray-700 p-6 rounded-xl';
                    // Template do cartão (simplificado)
                    cartaoEl.innerHTML = `
                        <h3 class="text-xl font-bold">${cartao.nome}</h3>
                        <p>Limite: R$ ${cartao.limite.toFixed(2)}</p>
                        <!-- Mais detalhes e forms iriam aqui -->
                    `;
                    containerEl.appendChild(cartaoEl);
                });
            });
        }

    </script>
</body>
</html>

